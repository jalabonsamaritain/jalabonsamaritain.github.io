<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="images/logo_isfa.png" type="image/png">
  <title>JalabonSamaritain</title>
  <style>
    /* ===== Reset & base ===== */
    *, *::before, *::after { box-sizing: border-box; }
    :root {
      --brand-1: #235A8C; /* header/footer */
      --brand-2: #0E76A8; /* nav */
      --text: #222;
      --bg: #f4f4f4;
      --card-bg: #fff;
      --radius: 12px;
      --space: clamp(12px, 2vw, 20px);
      --header-h: 64px; /* desktop only */
      --nav-h: 48px;    /* desktop only */
    }
    html { font-size: 16px; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Calibri, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; line-height:1.5; color:var(--text); background:var(--bg); }
    img, video, iframe { max-width:100%; height:auto; }
    a { color:#0645AD; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .container { width:min(100%, 70rem); margin-inline:auto; padding-inline: var(--space); }

    /* ===== Header & Nav (commun) ===== */
    header { background:var(--brand-1); color:#fff; }
    header .inner { display:flex; align-items:center; justify-content:center; min-height:var(--header-h); padding-block: 8px; }
    header a { color:#fff; text-decoration:none; }
    header a:hover{ color:#f9f9f9; }

    .nav { background:var(--brand-2); color:#fff; }
    .nav .inner { display:flex; align-items:center; justify-content:center; min-height:var(--nav-h); }
    #nav-list {
      display:flex; flex-direction: row; flex-wrap:wrap;
      align-items:center; justify-content:center; gap:14px; width:100%;
    }
    #nav-list a { color:#fff; padding:10px 12px; border-radius:8px; }
    #nav-list a:hover { background: rgb(255 255 255 / .12); }

    /* Desktop fixed header & nav */
    @media (min-width: 768px) {
      header { position: fixed; top:0; left:0; right:0; z-index: 20; }
      .nav { position: fixed; top: var(--header-h); left:0; right:0; z-index: 19; }
      body { padding-top: calc(var(--header-h) + var(--nav-h)); }
    }

    /* ===== Main welcome section ===== */
    .hero { padding-block: calc(var(--space) * 1.25); }
    .hero h1 { text-align:center; font-size: clamp(1.5rem, 1rem + 2.5vw, 2.5rem); margin: .25em 0 .5em; }
    .hero p { font-size: clamp(1rem, 0.9rem + 0.4vw, 1.125rem); margin: .5em 0; }

    /* ===== Boxes grid ===== */
    .box-grid { display:grid; gap: var(--space); grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); margin-top: var(--space); }
    .box { background:#f9f9f9; border-radius: var(--radius); padding: clamp(16px, 3vw, 28px); box-shadow: 0 2px 10px rgb(0 0 0 / .08); transition: transform .2s ease, box-shadow .2s ease; text-align:center; display:flex; align-items:center; justify-content:center; min-height: 120px; }
    .box a { color:#333; font-size: clamp(1rem, 0.9rem + 0.4vw, 1.25rem); display:inline-block; }
    .box:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgb(0 0 0 / .12); }
    .box-gold { border:1px solid gold; box-shadow:0 0 15px rgba(255,215,0,.35); font-weight:600; color: goldenrod; }

    /* ===== Brainteaser card ===== */
    .brainteaser-box { border:2px solid #8C7C68; border-radius:12px; padding: clamp(16px, 3vw, 24px); margin: var(--space) auto; background:linear-gradient(135deg,#fdfcfb,#e2d1c3); box-shadow:0 4px 10px rgba(0,0,0,.1); font-family:'Georgia', serif; }
    .brainteaser-header { display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom: .8em; flex-wrap: wrap; }
    .brainteaser-icon { font-size:1.2em; margin-right:.25em; color:#a67c52; }
    .brainteaser-title { margin:0; font-size: clamp(1.1rem, 1rem + .8vw, 1.4rem); color:#3c2f2f; display:flex; align-items:center; }
    .brainteaser-button { background-color:#AD8B00; color:white; border:none; padding:8px 14px; font-weight:bold; font-size:1rem; border-radius:8px; cursor:pointer; }
    .brainteaser-button:hover { background-color:#8C7C00; }

    .brainteaser-flex { display:flex; gap:16px; align-items:flex-start; }
    .brainteaser-content { flex:1; min-width: 0; }
    @media (max-width: 767px) { .brainteaser-flex { flex-direction: column; } }

    #brainteaser-answer { padding-top:.5em; border-top:1px dashed #ccc; margin-top:1em; color:#444; font-style:italic; display:none; }

    /* ===== Header ===== */
    #logo-jalabonsamaritain {
      cursor: pointer;              /* curseur main */
      text-decoration: none;        /* pas de soulign√© par d√©faut */
      color: inherit;               /* garde la couleur du texte */
      transition: color 0.2s ease;  /* effet fluide sur le hover */
    }

    #logo-jalabonsamaritain:hover {
      text-decoration: underline;   /* souligne quand on passe dessus */
    }

    /* ===== Tables (site-wide utility) ===== */
    .scroll-x { overflow-x:auto; -webkit-overflow-scrolling: touch; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f2f2f2; }

    /* ===== Footer ===== */
    footer { background:var(--brand-1); color:#fff; text-align:center; padding: 14px 0; margin-top: var(--space); }
    @media (min-width: 1024px) { footer.sticky { position:fixed; bottom:0; left:0; right:0; z-index:10; } }

    /* ===== Motion preferences ===== */
    @media (prefers-reduced-motion: reduce) {
      * { transition:none !important; scroll-behavior:auto !important; }
    }


  /* Accessibility: respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .egg-anim { animation: none !important; transition: none !important; }
  }

  /* ===== Confetti ===== */
  .confetti-layer {
    position: fixed; inset: 0; pointer-events: none; z-index: 9999;
    overflow: hidden;
  }
  .confetti {
    position: absolute;
    top: 0;                /* rep√®re commun */
    width: 8px; height: 12px; opacity: 0;   /* invisible au d√©part */
    transform: translate(var(--x, 0), -20vh) rotate(0deg); /* d√©j√† au-dessus de l'√©cran */
    will-change: transform, opacity;
  }
  @keyframes confetti-fall {
    0%   { transform: translate(var(--x, 0), -20vh) rotate(0deg);   opacity: 1; }
    80%  { opacity: 1; }
    100% { transform: translate(var(--x, 0), 110vh) rotate(720deg); opacity: 0.6; }
  }

  /* ===== Birthday banner ===== */
  .birthday-banner {
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 10000;
    background: #fff;              /* fond blanc */
    color: #111;                   /* texte fonc√© */
    padding: 10px 14px;
    border-radius: 12px;
    font: 600 16px/1.2 system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }

  /* Mobile : le banner prend toute la largeur en haut, et le body se d√©cale
   uniquement quand le banner est pr√©sent */
  @media (max-width: 767px) {
    .birthday-banner {
      position: fixed;
      top: 0;
      left: 0; right: 0;
      border-radius: 8 8 20px 20px;
      text-align: center;
      padding: 10px 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.2);
    }

    /* Quand le banner est l√†, on pousse le contenu vers le bas de sa hauteur */
    body.mobile-has-banner {
      padding-top: var(--mobile-banner-h, 0px);
      transition: padding-top 0.7s ease; /* pour un retrait fluide au fondu */
    }
  }
  </style>

  <!-- Polyfills & MathJax -->
  <!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> -->
  <script nomodule src="https://cdn.jsdelivr.net/npm/core-js-bundle@3.37.1/minified.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- JS: Brainteaser loader -->
  <script>
    // 1) Bases possibles (relative et absolue)
    const HERE = location.pathname.replace(/[^/]*$/, '');        // ex: /user/repo/  ou /user/repo/sousdir/
    const BT_BASES = [
      "html_files/brainteasers/",        // chemin relatif standard
      HERE + "html_files/brainteasers/"  // chemin relatif depuis la page courante
    ];

    // 2) Utilitaires
    function hashString(s){let h=5381;for(let i=0;i<s.length;i++)h=((h<<5)+h)+s.charCodeAt(i);return h>>>0;}
    function todayKey(){const d=new Date();const yyyy=d.getFullYear();const mm=String(d.getMonth()+1).padStart(2,"0");const dd=String(d.getDate()).padStart(2,"0");return `${yyyy}-${mm}-${dd}`;}
    function typeset(){ try { if (window.MathJax?.typesetPromise) MathJax.typesetPromise(); else if (window.MathJax?.typeset) MathJax.typeset(); } catch(_){} }

    async function fetchText(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status} pour ${url}`);
      return r.text();
    }
    async function fetchJSON(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status} pour ${url}`);
      return r.json();
    }

    // 3) Chargement index.json si dispo (accepte 2 formats)
    async function loadIndex(base){
      try{
        const data = await fetchJSON(base + "index.json");
        if (Array.isArray(data) && data.length){
          if (typeof data[0] === "string") {
            return data.map(f => ({ file: f }));
          } else if (typeof data[0] === "object" && data[0].file){
            return data;
          }
        }
        throw new Error("index.json vide ou mal form√©");
      }catch(e){
        // On remonte l'erreur pour d√©clencher le fallback
        throw e;
      }
    }

    // 4) Fallback : scan q1.html ‚Üí qN.html
    async function scanFolder(base, maxN = 60, concurrency = 6){
      const found = [];
      let i = 1;

      async function worker(){
        while(i <= maxN){
          const n = i++;
          const url = `${base}q${n}.html`;
          try {
            const html = await fetchText(url);
            found.push({ file: `q${n}.html`, html }); // on stocke peut-√™tre le html du premier rendu
          } catch(_){ /* ignore 404 */ }
        }
      }

      const workers = Array.from({length: concurrency}, worker);
      await Promise.all(workers);
      // Si on a pr√©charg√© le HTML, on ne le gardera que pour le premier rendu
      return found.sort((a,b)=>{
        // tri par num√©ro si possible
        const na = parseInt(a.file.match(/\d+/)?.[0] || "0", 10);
        const nb = parseInt(b.file.match(/\d+/)?.[0] || "0", 10);
        return na - nb;
      });
    }

    async function renderInto(el, base, entry, preloadedHTML){
      el.textContent = "Chargement...";
      try{
        const html = preloadedHTML ?? await fetchText(base + entry.file);
        el.innerHTML = html;
        typeset();
      }catch(err){
        console.error(err);
        el.textContent = "Erreur de chargement du brainteaser.";
      }
    }

    function pickDaily(len){ return hashString(todayKey()) % len; }
    function pickRandom(len, seen){
      if (len <= seen.size) seen.clear();
      let idx;
      do { idx = Math.floor(Math.random()*len); } while (seen.has(idx));
      seen.add(idx);
      return idx;
    }

    async function initBT(){
      const el = document.getElementById("brainteaser");
      if (!el){ return; }

      // A) Cas file:// (fetch bloqu√©)
      if (location.protocol === "file:"){
        el.innerHTML = "‚ö†Ô∏è Les brainteasers ne peuvent pas √™tre charg√©s en local. Lance un petit serveur HTTP (ex. <code>python -m http.server</code>) √† la racine du site.";
        return;
      }

      // B) On essaie chaque base possible
      let baseFound = null;
      let list = [];
      let preloadMap = new Map(); // file -> html (si pr√©charg√© via scan)

      for (const base of BT_BASES){
        // Essai index.json
        try{
          const index = await loadIndex(base);
          if (index?.length){
            baseFound = base;
            list = index.map(it => ({ file: it.file }));
            break;
          }
        }catch(_){}
        // Sinon, on v√©rifie au moins q1.html pour valider la base
        try{
          const html = await fetchText(base + "q1.html");
          baseFound = base;
          const scanned = await scanFolder(base);
          if (scanned.length){
            list = scanned.map(({file, html}) => {
              preloadMap.set(file, html);
              return { file };
            });
            break;
          }
        }catch(_){}
      }

      if (!baseFound || !list.length){
        console.error("Aucune base valide trouv√©e ou aucun brainteaser d√©tect√©.");
        el.textContent = "Erreur de chargement du brainteaser.";
        return;
      }

      // C) Rendu initial (index du jour)
      const seenToday = new Set();
      let currentIdx = pickDaily(list.length);
      seenToday.add(currentIdx);

      await renderInto(el, baseFound, list[currentIdx], preloadMap.get(list[currentIdx].file));

      // D) Bouton "Voir un autre"
      const btn = document.getElementById("new-brainteaser-btn");
      if (btn){
        btn.addEventListener("click", async ()=>{
          currentIdx = pickRandom(list.length, seenToday);
          await renderInto(el, baseFound, list[currentIdx], preloadMap.get(list[currentIdx].file));
        });
      }
    }

    document.addEventListener("DOMContentLoaded", initBT);
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-R168QL4ED7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-R168QL4ED7');
  </script>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container inner">
      <h1 style="margin:0; font-size: clamp(1.25rem, 1rem + 1vw, 1.75rem);">
        <a id="logo-jalabonsamaritain">JalabonSamaritain</a>
      </h1>
    </div>
  </header>

  <!-- Navigation -->
  <div class="nav" role="navigation" aria-label="Navigation principale">
    <div class="container inner">
      <div id="nav-list">
        <a href="index.html">Accueil</a>
        <a href="html_files/about.html">√Ä propos</a>
        <a href="html_files/contact.html">Contact</a>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <main class="container">
    <section class="hero">
      <h1>Bienvenue sur JalabonSamaritain</h1>
      <p style="text-align: justify;">Ce site internet a pour but de recenser l'ensemble de connaissances n√©cessaires √† l'actuaire pour sa formation.</p>
      <p style="text-align: justify;">Vous y retrouverez les documents mis √† disposition par les professeurs ainsi que l'ensemble de mes notes, annales etc.</p>
      <p style="text-align: justify;">Pour les plus motiv√©s ou les plus curieux d‚Äôentre vous, vous trouverez √©galement mes notes et documents de cours du master El Karoui. J‚Äôaurais aim√© disposer de tous ces documents d√®s mon arriv√©e au master, j‚Äôesp√®re donc qu‚Äôils seront d‚Äôune grande aide pour les prochains Isfa√Øens qui se lanceront dans l‚Äôaventure quantitative.</p>
      <p style="text-align:center;"><strong>Bonnes r√©visions les loulous</strong></p>

      <div class="box-grid" role="list">
        <div class="box" role="listitem"><a href="html_files/l3_actuariat.html">L3 Actuariat</a></div>
        <div class="box" role="listitem"><a href="html_files/m1_actuariat.html">M1 Actuariat</a></div>
        <div class="box" role="listitem"><a href="html_files/m2_actuariat.html">M2 Actuariat</a></div>
        <div class="box box-gold" role="listitem"><a href="html_files/EK.html">Master El Karoui <br><span style="font-size:0.9em;">(pour les stars ‚≠ê)</span></a></div>
      </div>
    </section>

    <section class="brainteaser-box">
      <div class="brainteaser-header">
        <h3 class="brainteaser-title"><span class="brainteaser-icon">üß†</span>Brainteaser du jour</h3>
        <button id="new-brainteaser-btn" class="brainteaser-button">üîÑ Voir un autre</button>
      </div>

      <div class="brainteaser-flex">
        <div id="brainteaser" class="brainteaser-content">Chargement...</div>
      </div>

      <div id="brainteaser-answer"></div>
    </section>
  </main>

  <div style="height: 2rem;"></div>

  <!-- Footer -->
  <footer class="sticky">
    Th√©o Jalabert | Tous droits r√©serv√©s ¬© 2025
  </footer>

  <script>
  /* ========= JalabonSamaritain Easter Egg (Birthday) ========= */
  (() => {
  const TZ = 'Europe/Paris';

  function todayInTZ() {
    const now = new Date();
    const parts = new Intl.DateTimeFormat('fr-FR', {
      timeZone: TZ, year: 'numeric', month: 'numeric', day: 'numeric'
    }).formatToParts(now);
    const obj = Object.fromEntries(parts.map(p => [p.type, p.value]));
    return { y: +obj.year, m: +obj.month, d: +obj.day };
  }

  function shownOncePerDay(keyBase) {
    const { y, m, d } = todayInTZ();
    const key = `${keyBase}:${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    if (localStorage.getItem(key)) return true;
    // Clean old keys of same base to avoid clutter
    Object.keys(localStorage).forEach(k => { if (k.startsWith(`${keyBase}:`)) localStorage.removeItem(k); });
    localStorage.setItem(key, '1');
    return false;
  }

  /* ========== Birthday: 21 April ========== */
  function runBirthday() {
    const banner = document.createElement('div');
    banner.className = 'birthday-banner egg-anim';
    banner.textContent = 'üéâ Joyeux anniversaire, Th√©o ! üéÇ';
    document.body.appendChild(banner);

    // --- Mobile: r√©server l'espace du banner tant qu'il est visible ---
    const isMobile = window.matchMedia('(max-width: 767px)').matches;
    if (isMobile) {
      // On attend un frame que le layout se stabilise, puis on mesure
      requestAnimationFrame(() => {
        const h = Math.ceil(banner.getBoundingClientRect().height);
        document.body.style.setProperty('--mobile-banner-h', h + 'px');
        document.body.classList.add('mobile-has-banner');
      });
    }

    // Couche confettis
    const layer = document.createElement('div');
    layer.className = 'confetti-layer egg-anim';
    document.body.appendChild(layer);

    // Confettis
    const N = 120;
    for (let i = 0; i < N; i++) {
      const piece = document.createElement('div');
      piece.className = 'confetti egg-anim';
      const hue = Math.floor(Math.random() * 360);
      piece.style.background = `hsl(${hue} 90% 55%)`;
      const x = Math.random() * window.innerWidth;
      piece.style.left = `${x}px`;
      piece.style.setProperty('--x', `${Math.random() * 10 - 5}vw`);
      layer.appendChild(piece);
      requestAnimationFrame(() => {
        const delay = Math.random();
        piece.style.animation = `confetti-fall ${6 + Math.random() * 4}s linear ${delay}s forwards`;
        piece.style.opacity = '1';
      });
    }

    // --- FONDU + retrait de l'espace mobile ---
    const DISPLAY_MS = 10000; // affichage avant fondu
    const FADE_MS = 700;      // dur√©e du fondu

    const fadeOutAndRemove = (el) => {
      if (!el) return;
      el.style.transition = `opacity ${FADE_MS}ms ease`;
      el.style.willChange = 'opacity';
      void el.offsetWidth;            // force reflow
      el.style.opacity = '0';
      const clean = () => el.remove();
      el.addEventListener('transitionend', clean, { once: true });
      setTimeout(clean, FADE_MS + 120);
    };

    setTimeout(() => {
      // Sur mobile : on remet le padding-top √† 0 pendant le fondu
      if (isMobile) {
        document.body.style.setProperty('--mobile-banner-h', '0px');
        // on retire la classe apr√®s la transition de padding
        setTimeout(() => {
          document.body.classList.remove('mobile-has-banner');
          document.body.style.removeProperty('--mobile-banner-h');
        }, FADE_MS + 50);
      }
      fadeOutAndRemove(banner);
      fadeOutAndRemove(layer);
    }, DISPLAY_MS);
  }

  /* ===== Orchestrate by date (TZ Europe/Paris) ===== */
  const { m, d } = todayInTZ();
  if (m === 4 && d === 21) runBirthday();
  })();

  /* ========= JalabonSamaritain Easter Egg (triple-click logo) + Soft Gate ========= */
  document.addEventListener("DOMContentLoaded", () => {
    const logo = document.getElementById("logo-jalabonsamaritain");
    if (!logo) return;

    /* ====== R√©glages ====== */
    const GATE_PROB = 0.05;           // ~5% des visites
    const GATE_COOLDOWN_DAYS = 7;     // pas plus d‚Äô1 gate / semaine
    const SKIP_DELAY = 4;             // secondes avant que "Skip" apparaisse

    /* ====== CSS inject√© ====== */
    const style = document.createElement("style");
    style.textContent = `
      body.egg-active::before{
        content:""; position:fixed; inset:0; z-index:-1; pointer-events:none;
        background: linear-gradient(120deg,#0e76a833,#b993d699,#ffd16666,#06d6a066,#118ab266);
        background-size: 300% 300%;
        animation: eggGradient 12s ease infinite;
        filter: saturate(1.15) brightness(1.05);
      }
      @keyframes eggGradient {
        0%{ background-position: 0% 50%; }
        50%{ background-position: 100% 50%; }
        100%{ background-position: 0% 50%; }
      }

      .egg-floaters, .egg-equations{
        position: fixed; inset: 0; overflow: hidden; z-index: 9998; pointer-events: none;
        opacity: .95;
      }
      /* Emojis = animation verticale (une run, on re-spawn via JS en boucle) */
      .egg-floater{
        position: absolute;
        will-change: transform, opacity;
        filter: drop-shadow(0 2px 2px rgba(0,0,0,.15));
        animation: floatUp linear var(--dur) both; /* pas d'infinite ici */
      }
      @keyframes floatUp {
        0%{
          transform:
            translateX(var(--x))
            translateY(0)
            rotate(var(--rotStart));
          opacity: 0;
        }
        10%{ opacity: 1; }
        85%{ opacity: 1; }
        100%{
          transform:
            translateX(calc(var(--x) + 40px))
            translateY(-220vh)
            rotate(var(--rotEnd));
          opacity: 0;
        }
      }

      /* √âquations = pas d‚Äôanimation CSS (pilot√©es en JS) */
      .egg-equation{
        position:absolute; will-change: transform, opacity;
        filter: drop-shadow(0 2px 2px rgba(0,0,0,.15));
      }

      .egg-toast{
        position: fixed; top: 14px; left: 50%; transform: translateX(-50%);
        background: #111a; color: #fff; backdrop-filter: blur(6px);
        border: 1px solid #fff3; border-radius: 12px; padding: 10px 14px; z-index: 9999;
        font: 600 14px/1.2 ui-sans-serif, system-ui, Segoe UI, Roboto, Arial;
        box-shadow: 0 8px 30px rgba(0,0,0,.16);
        animation: toastIn .35s ease both;
      }
      @keyframes toastIn {
        from { transform: translate(-50%, -8px); opacity: 0; }
        to   { transform: translate(-50%, 0);   opacity: 1; }
      }

      .egg-confetti{ position: fixed; inset: 0; z-index: 9997; pointer-events: none; }

      /* ====== Soft Gate ====== */
      body.egg-gated { overflow: hidden; }
      .egg-gate{
        position: fixed; inset:0; z-index: 10000;
        display: grid; place-items: center;
        background: rgba(15,18,23,.72);
        backdrop-filter: blur(4px);
      }
      .egg-gate .panel{
        width: min(520px, 92vw);
        background: #0f172a; color: #fff;
        border-radius: 16px; padding: 18px 18px 14px;
        box-shadow: 0 12px 40px rgba(0,0,0,.4);
        position: relative; isolation: isolate;
      }
      .egg-gate .panel::before{
        content:""; position:absolute; inset: -2px; z-index:-1; border-radius:18px;
        background: conic-gradient(from 140deg, #8a2be2, #00d4ff, #ffd166, #06d6a0, #8a2be2);
        filter: blur(10px) saturate(1.2); opacity:.55;
        mask: linear-gradient(#000 0 0) exclude, linear-gradient(#000 0 0);
      }
      .egg-gate h3{ margin:0 0 6px 0; font-size: 1.1rem; letter-spacing:.2px }
      .egg-gate p{ margin: 0 0 10px 0; opacity: .95 }
      .egg-gate .hint{ font-size:.92rem; opacity:.9 }
      .egg-gate .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:10px }
      .egg-gate button{
        border:1px solid #ffffff33; background:#ffffff12; color:#fff;
        border-radius:10px; padding:8px 12px; cursor:pointer;
        transition: transform .15s ease, background .15s ease;
      }
      .egg-gate button:hover{ transform: translateY(-1px); background:#ffffff18; }
      .egg-gate button[disabled]{ opacity:.6; cursor:not-allowed; transform:none !important; }
    `;
    document.head.appendChild(style);

    /* ====== MathJax readiness ====== */
    async function waitForMathJax(){
      if (window.MathJax?.typesetPromise) {
        try { if (MathJax.startup?.promise) await MathJax.startup.promise; } catch(_){}
        return;
      }
      await new Promise(resolve => {
        let tries = 0;
        const t = setInterval(() => {
          if (window.MathJax?.typesetPromise) {
            clearInterval(t);
            if (MathJax.startup?.promise) MathJax.startup.promise.then(resolve).catch(resolve);
            else resolve();
          } else if (++tries > 120) { clearInterval(t); resolve(); }
        }, 125);
      });
    }

    /* ====== Toast ====== */
    function showToast(msg){
      const t = document.createElement("div");
      t.className = "egg-toast";
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1800);
    }

    /* ====== Floaters (√©motic√¥nes en flux continu) ====== */
    let floatLayer = null, eqLayer = null, eqRaf = null, emojiSpawnerStop = null;

    function makeFloaters(){
      floatLayer = document.createElement("div");
      floatLayer.className = "egg-floaters";
      document.body.appendChild(floatLayer);

      const emojis = ["üìò","üìó","üìê","üß†","üìà","üßÆ","üéì","üìä","‚ú®", "üíπ","üìö","üí°","üî¢","üìù","üìä","üí∂","ü§ì","üõ©Ô∏è"];

      // Spawne un emoji (une run), puis en re-spawne un autre √† la fin => flux continu
      function spawnOne(){
        if (!floatLayer) return; // d√©j√† stopp√©

        const span = document.createElement("span");
        span.className = "egg-floater";
        span.textContent = emojis[Math.floor(Math.random()*emojis.length)];

        // Position de d√©part : sous l'√©cran
        span.style.left = (Math.random()*100) + "vw";
        span.style.top  = "110vh";

        // L√©g√®re d√©rive horizontale & timings
        span.style.setProperty("--x", (Math.random()*80 - 40) + "px");
        span.style.setProperty("--dur", (6.5 + Math.random()*6.5) + "s");

        // Rotation propre √† chaque emoji
        const startDeg = Math.floor(Math.random()*360);
        const turns = 0.75 + Math.random()*1.75; // 0.75‚Äì2.5 tours
        const endDeg = startDeg + turns*360 * (Math.random() < 0.5 ? -1 : 1);
        span.style.setProperty("--rotStart", startDeg + "deg");
        span.style.setProperty("--rotEnd", endDeg + "deg");

        // Taille
        span.style.fontSize = (18 + Math.random()*12) + "px";

        // Quand l'anim finit, on enl√®ve et on respawn
        span.addEventListener("animationend", () => {
          span.remove();
          if (floatLayer) spawnOne();
        });

        floatLayer.appendChild(span);
      }

      // On lance un petit pool initial pour un flux r√©gulier
      const INITIAL_POOL = 14; // ajuste si tu veux plus/moins de densit√©
      for (let i=0;i<INITIAL_POOL;i++){
        // petit d√©calage de d√©part pour √©viter qu'ils partent tous d'un coup
        setTimeout(spawnOne, i * 180 + Math.random()*140);
      }

      // Safety: fonction pour stopper proprement le spawner (appel√©e au deactivate)
      emojiSpawnerStop = () => {
        if (!floatLayer) return;
        Array.from(floatLayer.children).forEach(n => n.remove());
        floatLayer.remove();
        floatLayer = null;
      };
    }

    /* ====== √âquations (mouvement horizontal + oscillation sinuso√Ødale douce) ====== */
    function randBetween(a,b){ return a + Math.random()*(b-a); }
    function shuffleInPlace(arr){
      for (let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    async function makeEquations(){
      await waitForMathJax();

      eqLayer = document.createElement("div");
      eqLayer.className = "egg-equations";
      document.body.appendChild(eqLayer);

      const equationsTeX = [
        // Black‚ÄìScholes de base
        String.raw`\( \displaystyle dS_t = \mu S_t \,dt + \sigma S_t \,dW_t \)`,
        String.raw`\( \displaystyle C(S,t) = S \Phi(d_1) - K e^{-r(T-t)} \Phi(d_2) \)`,
        String.raw`\( \displaystyle V_t = \mathbb{E}^{\mathbb{Q}}\left[ e^{-\int\limits_{t}^{T} r_s \,ds} \, H \, \middle| \, \mathcal{F}_t \right] \)`,
        String.raw`\( \displaystyle \Theta + \tfrac{1}{2}\sigma^2 S^2 \Gamma + rS \Delta - rV = 0 \)`,

        // Hull‚ÄìWhite (taux d‚Äôint√©r√™t)
        String.raw`\( \displaystyle dr_t = \big(\theta(t) - a r_t\big)\,dt + \sigma_t \, dW_t^{\mathbb{Q}} \)`,

        // Heston (stochastic volatility, syst√®me)
        String.raw`\(
        \begin{cases}
        dS_t = \mu S_t \, dt + \sqrt{v_t} \, S_t \, dW_t^{(1)} \\\\
        dv_t = \kappa(\theta - v_t) \, dt + \xi \sqrt{v_t} \, dW_t^{(2)} \\\\
        dW_t^{(1)} dW_t^{(2)} = \rho \,dt
        \end{cases}\)`,

        // SABR (stochastic volatility, syst√®me)
        String.raw`\( 
        \begin{cases}
        dF_t = \sigma_t F_t^{\beta} \, dW_t^{(1)} \\\\
        d\sigma_t = \nu \sigma_t \, dW_t^{(2)} \\\\
        dW_t^{(1)} dW_t^{(2)} = \rho \,dt
        \end{cases}\)`,

        // Grecques
        String.raw`\( \displaystyle \Delta = \Phi(d_1) \)`,
        String.raw`\( \displaystyle \Gamma = \frac{\varphi(d_1)}{S\,\sigma\,\sqrt{\tau}} \)`,
        String.raw`\( \displaystyle Vega = S \sqrt{\tau}\,\varphi(d_1) \)`,
        String.raw`\( \displaystyle \Theta = -\frac{S \sigma \varphi(d_1)}{2\sqrt{\tau}} - rK e^{-r\tau}\Phi(d_2) \)`,
        String.raw`\( \displaystyle Volga = S \varphi(d_1)\sqrt{\tau}\,(d_1 d_2 / \sigma) \)`

        ];

      // It√©rateur al√©atoire : reshuffle automatique quand on a tout consomm√©
      const pool = shuffleInPlace(equationsTeX.slice());
      let cursor = 0;
      function nextEq(){
        if (cursor >= pool.length){
          shuffleInPlace(pool);
          cursor = 0;
        }
        return pool[cursor++];
      }

      // Nombre d‚Äô√©quations visibles simultan√©ment
      const count = Math.floor(randBetween(4, 7));
      const objs = [];

      // Cr√©ation initiale (contenu randomis√©)
      for (let i = 0; i < count; i++){
        const eq = document.createElement("div");
        eq.className = "egg-equation";
        eq.style.fontSize = (14 + Math.random()*6) + "px";
        eq.innerHTML = nextEq();
        eqLayer.appendChild(eq);
      }

      try {
        if (window.MathJax?.typesetPromise) {
          await MathJax.typesetPromise([eqLayer]);
        } else if (window.MathJax?.typeset) {
          MathJax.typeset([eqLayer]);
        }
      } catch(_) {}

      const H = () => window.innerHeight;
      const W = () => window.innerWidth;

      Array.from(eqLayer.children).forEach((el, idx) => {
        const dir = Math.random() < 0.5 ? -1 : 1;        // -1: droite‚Üígauche, 1: gauche‚Üídroite
        const baseYvh = randBetween(10, 85);             // ligne de base (vh)
        const amp = randBetween(26, 50);                 // amplitude verticale (px)
        const speed = randBetween(140, 200);             // px/s horizontal
        const omega = randBetween(1.6, 3.2);             // vitesse angulaire vague
        const phase0 = Math.random() * Math.PI * 2;      // phase initiale

        const startX = dir === 1 ? -60 : W()+60;

        objs.push({
          el,
          dir,
          baseYvh,
          amp,
          speed,
          omega,
          phase0,
          x: startX,
          t0: performance.now() - Math.random()*4000
        });
      });

      function animate(t){
        const width = W(), height = H();
        for (const o of objs){
          const dt = (t - o.t0)/1000;
          o.x = o.dir === 1 ? (-60 + o.speed*dt) : (width + 60 - o.speed*dt);
          const baseY = o.baseYvh/100 * height;
          const y = baseY + o.amp * Math.sin(o.phase0 + o.omega * dt);

          let alpha = 1;
          const fade = 120;
          if (o.x < fade) alpha = Math.max(0, (o.x)/fade);
          if (o.x > width - fade) alpha = Math.max(0, (width - o.x)/fade);

          o.el.style.transform = `translate(${o.x}px, ${y}px)`;
          o.el.style.opacity = alpha;

          // Recycle : on repart de l‚Äôautre c√¥t√© + on assigne UNE NOUVELLE √âQUATION
          if (o.dir === 1 && o.x > width + 80){
            o.t0 = t; o.x = -60;
            o.baseYvh = randBetween(10,85);
            o.phase0 = Math.random()*Math.PI*2;
            o.el.innerHTML = nextEq();
            try { window.MathJax?.typeset ? MathJax.typeset([o.el]) : null; } catch(_){}
          } else if (o.dir === -1 && o.x < -80){
            o.t0 = t; o.x = width + 60;
            o.baseYvh = randBetween(10,85);
            o.phase0 = Math.random()*Math.PI*2;
            o.el.innerHTML = nextEq();
            try { window.MathJax?.typeset ? MathJax.typeset([o.el]) : null; } catch(_){}
          }
        }
        eqRaf = requestAnimationFrame(animate);
      }
      eqRaf = requestAnimationFrame(animate);
    }

    function stopEquations(){
      if (eqRaf) cancelAnimationFrame(eqRaf);
      eqRaf = null;
    }

    /* ====== Confettis (plus longs + fondu progressif) ====== */
    let confettiCanvas = null, confettiCtx = null, rafId = null;
    const onResize = () => {
      if (confettiCanvas){
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      }
    };
    function confettiBurst(){
      confettiCanvas = document.createElement("canvas");
      confettiCanvas.className = "egg-confetti";
      confettiCtx = confettiCanvas.getContext("2d");
      document.body.appendChild(confettiCanvas);
      onResize();
      window.addEventListener("resize", onResize);

      const pieces = Array.from({length: 220}).map(()=> ({
        x: Math.random()*confettiCanvas.width,
        y: -20 - Math.random()*confettiCanvas.height*0.4,
        r: 4 + Math.random()*4,
        vy: 2 + Math.random()*3,
        vx: -1 + Math.random()*2,
        a: Math.random()*Math.PI*2,
        spin: (-0.25 + Math.random()*0.5),
        hue: Math.floor(Math.random()*360)
      }));

      const DURATION = 5.5;
      const FADE_START = 4.2;

      const start = performance.now();
      (function loop(t){
        const elapsed = (t - start)/1000;
        if (elapsed > DURATION + 0.15){ stopConfetti(); return; }
        rafId = requestAnimationFrame(loop);

        let alpha = 1;
        if (elapsed > FADE_START){
          const k = Math.min(1, (elapsed - FADE_START) / (DURATION - FADE_START));
          alpha = 1 - (k*k*(3 - 2*k));
        }

        confettiCtx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
        confettiCtx.globalAlpha = alpha;

        for (const p of pieces){
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.015;
          p.a += p.spin;

          confettiCtx.save();
          confettiCtx.translate(p.x, p.y);
          confettiCtx.rotate(p.a);
          confettiCtx.fillStyle = `hsl(${p.hue}, 90%, 55%)`;
          confettiCtx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
          confettiCtx.restore();
        }
        confettiCtx.globalAlpha = 1;
      })(start);
    }
    function stopConfetti(){
      if (rafId) cancelAnimationFrame(rafId);
      rafId = null;
      if (confettiCanvas){
        window.removeEventListener("resize", onResize);
        confettiCanvas.remove();
        confettiCanvas = null; confettiCtx = null;
      }
    }

    /* ====== Soft gate (rare + skippable apr√®s d√©lai) ====== */
    let gateEl = null;
    function daysSince(ts){
      const MS = 24*3600*1000;
      return (Date.now() - ts)/MS;
    }
    function shouldGate(){
      try {
        const last = Number(localStorage.getItem("eggGateLast") || 0);
        if (last && daysSince(last) < GATE_COOLDOWN_DAYS) return false;
        return Math.random() < GATE_PROB;
      } catch { return false; }
    }
    function markGated(){
      try { localStorage.setItem("eggGateLast", String(Date.now())); } catch {}
    }
    function showGate(){
      gateEl = document.createElement("div");
      gateEl.className = "egg-gate";
      gateEl.innerHTML = `
        <div class="panel" role="dialog" aria-modal="true" aria-label="Mystery mode">
          <h3>üîí Mystery mode</h3>
          <p>Un petit secret se cache sur cette page‚Ä¶</p>
          <p class="hint">Astuce : triple-clique sur <strong>Jalabonsamaritain</strong> dans l‚Äôen-t√™te pour d√©verrouiller ‚ú®</p>
          <div class="actions">
            <button id="gate-skip" disabled>Skip (${SKIP_DELAY})</button>
          </div>
        </div>
      `;
      document.body.appendChild(gateEl);
      document.body.classList.add("egg-gated");

      const btn = gateEl.querySelector("#gate-skip");
      let t = SKIP_DELAY;
      const int = setInterval(() => {
        t -= 1;
        btn.textContent = t > 0 ? `Skip (${t})` : "Skip";
        if (t <= 0){
          clearInterval(int);
          btn.disabled = false;
        }
      }, 1000);

      btn.addEventListener("click", () => hideGate(true));
      document.addEventListener("keydown", escHandler);
    }
    function escHandler(e){
      if (e.key === "Escape"){
        const btn = gateEl?.querySelector("#gate-skip");
        if (btn && !btn.disabled) hideGate(true);
      }
    }
    function hideGate(skipped=false){
      if (!gateEl) return;
      gateEl.remove();
      gateEl = null;
      document.body.classList.remove("egg-gated");
      document.removeEventListener("keydown", escHandler);
      if (!skipped) markGated();
    }

    /* ====== Toggle egg ====== */
    let eggActive = false;
    function isGateOpen(){ return !!gateEl; }

    async function activateEgg(){
      eggActive = true;
      if (isGateOpen()) hideGate(false);
      document.body.classList.add("egg-active");
      makeFloaters();          // emojis en flux continu
      await makeEquations();   // √©quations (inchang√©)
      confettiBurst();
      showToast("‚ú® Secret mode ON");
    }
    function deactivateEgg(){
      eggActive = false;
      document.body.classList.remove("egg-active");
      if (emojiSpawnerStop) { emojiSpawnerStop(); emojiSpawnerStop = null; } // stop emojis proprement
      if (eqLayer){ stopEquations(); eqLayer.remove(); eqLayer = null; }    // stop + remove √©quations
      stopConfetti();
      showToast("üîô Back to normal");
    }

    // Triple-clic : ON/OFF
    let clickCount = 0, timer = null;
    logo.addEventListener("click", () => {
      clickCount++;
      if (clickCount === 1){
        timer = setTimeout(()=>{ clickCount = 0; }, 1200);
      }
      if (clickCount === 3){
        clearTimeout(timer); clickCount = 0;
        eggActive ? deactivateEgg() : activateEgg();
      }
    });

    // Accessibilit√© clavier : Enter/Space = click
    logo.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        logo.click();
      }
    });

    // Affiche le gate si n√©cessaire (rare + cooldown)
    if (shouldGate()){
      showGate();
    }
  });
</script>

</body>
</html>