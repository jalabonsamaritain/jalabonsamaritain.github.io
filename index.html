<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="images/logo_isfa.png" type="image/png">
  <title>JalabonSamaritain</title>
  <style>
    /* ===== Reset & base ===== */
    *, *::before, *::after { box-sizing: border-box; }
    :root {
      --brand-1: #235A8C; /* header/footer */
      --brand-2: #0E76A8; /* nav */
      --text: #222;
      --bg: #f4f4f4;
      --card-bg: #fff;
      --radius: 12px;
      --space: clamp(12px, 2vw, 20px);
      --header-h: 64px; /* desktop only */
      --nav-h: 48px;    /* desktop only */
    }
    html { font-size: 16px; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Calibri, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; line-height:1.5; color:var(--text); background:var(--bg); }
    img, video, iframe { max-width:100%; height:auto; }
    a { color:#0645AD; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .container { width:min(100%, 70rem); margin-inline:auto; padding-inline: var(--space); }

    /* ===== Header & Nav (commun) ===== */
    header { background:var(--brand-1); color:#fff; }
    header .inner { display:flex; align-items:center; justify-content:center; min-height:var(--header-h); padding-block: 8px; }
    header a { color:#fff; text-decoration:none; }
    header a:hover{ color:#f9f9f9; }

    .nav { background:var(--brand-2); color:#fff; }
    .nav .inner { display:flex; align-items:center; justify-content:center; min-height:var(--nav-h); }
    #nav-list {
      display:flex; flex-direction: row; flex-wrap:wrap;
      align-items:center; justify-content:center; gap:14px; width:100%;
    }
    #nav-list a { color:#fff; padding:10px 12px; border-radius:8px; }
    #nav-list a:hover { background: rgb(255 255 255 / .12); }

    /* Desktop fixed header & nav */
    @media (min-width: 768px) {
      header { position: fixed; top:0; left:0; right:0; z-index: 20; }
      .nav { position: fixed; top: var(--header-h); left:0; right:0; z-index: 19; }
      body { padding-top: calc(var(--header-h) + var(--nav-h)); }
    }

    /* ===== Main welcome section ===== */
    .hero { padding-block: calc(var(--space) * 1.25); }
    .hero h1 { text-align:center; font-size: clamp(1.5rem, 1rem + 2.5vw, 2.5rem); margin: .25em 0 .5em; }
    .hero p { font-size: clamp(1rem, 0.9rem + 0.4vw, 1.125rem); margin: .5em 0; }

    /* ===== Boxes grid ===== */
    .box-grid { display:grid; gap: var(--space); grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); margin-top: var(--space); }
    .box { background:#f9f9f9; border-radius: var(--radius); padding: clamp(16px, 3vw, 28px); box-shadow: 0 2px 10px rgb(0 0 0 / .08); transition: transform .2s ease, box-shadow .2s ease; text-align:center; display:flex; align-items:center; justify-content:center; min-height: 120px; }
    .box a { color:#333; font-size: clamp(1rem, 0.9rem + 0.4vw, 1.25rem); display:inline-block; }
    .box:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgb(0 0 0 / .12); }
    .box-gold { border:1px solid gold; box-shadow:0 0 15px rgba(255,215,0,.35); font-weight:600; color: goldenrod; }

    /* ===== Brainteaser card ===== */
    .brainteaser-box { border:2px solid #8C7C68; border-radius:12px; padding: clamp(16px, 3vw, 24px); margin: var(--space) auto; background:linear-gradient(135deg,#fdfcfb,#e2d1c3); box-shadow:0 4px 10px rgba(0,0,0,.1); font-family:'Georgia', serif; }
    .brainteaser-header { display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom: .8em; flex-wrap: wrap; }
    .brainteaser-icon { font-size:1.2em; margin-right:.25em; color:#a67c52; }
    .brainteaser-title { margin:0; font-size: clamp(1.1rem, 1rem + .8vw, 1.4rem); color:#3c2f2f; display:flex; align-items:center; }
    .brainteaser-button { background-color:#AD8B00; color:white; border:none; padding:8px 14px; font-weight:bold; font-size:1rem; border-radius:8px; cursor:pointer; }
    .brainteaser-button:hover { background-color:#8C7C00; }

    .brainteaser-flex { display:flex; gap:16px; align-items:flex-start; }
    .brainteaser-content { flex:1; min-width: 0; }
    @media (max-width: 767px) { .brainteaser-flex { flex-direction: column; } }

    #brainteaser-answer { padding-top:.5em; border-top:1px dashed #ccc; margin-top:1em; color:#444; font-style:italic; display:none; }

    /* ===== Tables (site-wide utility) ===== */
    .scroll-x { overflow-x:auto; -webkit-overflow-scrolling: touch; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f2f2f2; }

    /* ===== Footer ===== */
    footer { background:var(--brand-1); color:#fff; text-align:center; padding: 14px 0; margin-top: var(--space); }
    @media (min-width: 1024px) { footer.sticky { position:fixed; bottom:0; left:0; right:0; z-index:10; } }

    /* ===== Motion preferences ===== */
    @media (prefers-reduced-motion: reduce) {
      * { transition:none !important; scroll-behavior:auto !important; }
    }
  </style>

  <!-- Polyfills & MathJax -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- JS: Brainteaser loader -->
  <script>
    // 1) Bases possibles (relative et absolue)
    const BT_BASES = ["htm_files/brainteasers/", "/htm_files/brainteasers/"];

    // 2) Utilitaires
    function hashString(s){let h=5381;for(let i=0;i<s.length;i++)h=((h<<5)+h)+s.charCodeAt(i);return h>>>0;}
    function todayKey(){const d=new Date();const yyyy=d.getFullYear();const mm=String(d.getMonth()+1).padStart(2,"0");const dd=String(d.getDate()).padStart(2,"0");return `${yyyy}-${mm}-${dd}`;}
    function typeset(){ try { if (window.MathJax?.typesetPromise) MathJax.typesetPromise(); else if (window.MathJax?.typeset) MathJax.typeset(); } catch(_){} }

    async function fetchText(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status} pour ${url}`);
      return r.text();
    }
    async function fetchJSON(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status} pour ${url}`);
      return r.json();
    }

    // 3) Chargement index.json si dispo (accepte 2 formats)
    async function loadIndex(base){
      try{
        const data = await fetchJSON(base + "index.json");
        if (Array.isArray(data) && data.length){
          if (typeof data[0] === "string") {
            return data.map(f => ({ file: f }));
          } else if (typeof data[0] === "object" && data[0].file){
            return data;
          }
        }
        throw new Error("index.json vide ou mal form√©");
      }catch(e){
        // On remonte l'erreur pour d√©clencher le fallback
        throw e;
      }
    }

    // 4) Fallback : scan q1.html ‚Üí qN.html
    async function scanFolder(base, maxN = 60, concurrency = 6){
      const found = [];
      let i = 1;

      async function worker(){
        while(i <= maxN){
          const n = i++;
          const url = `${base}q${n}.html`;
          try {
            const html = await fetchText(url);
            found.push({ file: `q${n}.html`, html }); // on stocke peut-√™tre le html du premier rendu
          } catch(_){ /* ignore 404 */ }
        }
      }

      const workers = Array.from({length: concurrency}, worker);
      await Promise.all(workers);
      // Si on a pr√©charg√© le HTML, on ne le gardera que pour le premier rendu
      return found.sort((a,b)=>{
        // tri par num√©ro si possible
        const na = parseInt(a.file.match(/\d+/)?.[0] || "0", 10);
        const nb = parseInt(b.file.match(/\d+/)?.[0] || "0", 10);
        return na - nb;
      });
    }

    async function renderInto(el, base, entry, preloadedHTML){
      el.textContent = "Chargement...";
      try{
        const html = preloadedHTML ?? await fetchText(base + entry.file);
        el.innerHTML = html;
        typeset();
      }catch(err){
        console.error(err);
        el.textContent = "Erreur de chargement du brainteaser.";
      }
    }

    function pickDaily(len){ return hashString(todayKey()) % len; }
    function pickRandom(len, seen){
      if (len <= seen.size) seen.clear();
      let idx;
      do { idx = Math.floor(Math.random()*len); } while (seen.has(idx));
      seen.add(idx);
      return idx;
    }

    async function initBT(){
      const el = document.getElementById("brainteaser");
      if (!el){ return; }

      // A) Cas file:// (fetch bloqu√©)
      if (location.protocol === "file:"){
        el.innerHTML = "‚ö†Ô∏è Les √©nigmes ne peuvent pas √™tre charg√©es en local. Lance un petit serveur HTTP (ex. <code>python -m http.server</code>) √† la racine du site.";
        return;
      }

      // B) On essaie chaque base possible
      let baseFound = null;
      let list = [];
      let preloadMap = new Map(); // file -> html (si pr√©charg√© via scan)

      for (const base of BT_BASES){
        // Essai index.json
        try{
          const index = await loadIndex(base);
          if (index?.length){
            baseFound = base;
            list = index.map(it => ({ file: it.file }));
            break;
          }
        }catch(_){}
        // Sinon, on v√©rifie au moins q1.html pour valider la base
        try{
          const html = await fetchText(base + "q1.html");
          baseFound = base;
          const scanned = await scanFolder(base);
          if (scanned.length){
            list = scanned.map(({file, html}) => {
              preloadMap.set(file, html);
              return { file };
            });
            break;
          }
        }catch(_){}
      }

      if (!baseFound || !list.length){
        console.error("Aucune base valide trouv√©e ou aucun brainteaser d√©tect√©.");
        el.textContent = "Erreur de chargement du brainteaser.";
        return;
      }

      // C) Rendu initial (index du jour)
      const seenToday = new Set();
      let currentIdx = pickDaily(list.length);
      seenToday.add(currentIdx);

      await renderInto(el, baseFound, list[currentIdx], preloadMap.get(list[currentIdx].file));

      // D) Bouton "Voir un autre"
      const btn = document.getElementById("new-brainteaser-btn");
      if (btn){
        btn.addEventListener("click", async ()=>{
          currentIdx = pickRandom(list.length, seenToday);
          await renderInto(el, baseFound, list[currentIdx], preloadMap.get(list[currentIdx].file));
        });
      }
    }

    document.addEventListener("DOMContentLoaded", initBT);
  </script>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container inner">
      <h1 style="margin:0; font-size: clamp(1.25rem, 1rem + 1vw, 1.75rem);">
        <a href="index.html">JalabonSamaritain</a>
      </h1>
    </div>
  </header>

  <!-- Navigation -->
  <div class="nav" role="navigation" aria-label="Navigation principale">
    <div class="container inner">
      <div id="nav-list">
        <a href="index.html">Accueil</a>
        <a href="html_files/about.html">√Ä propos</a>
        <a href="html_files/contact.html">Contact</a>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <main class="container">
    <section class="hero">
      <h1>Bienvenue sur JalabonSamaritain</h1>
      <p style="text-align: justify;">Ce site internet a pour but de recenser l'ensemble de connaissances n√©cessaires √† l'actuaire pour sa formation.</p>
      <p style="text-align: justify;">Vous y retrouverez les documents mis √† disposition par les professeurs ainsi que l'ensemble de mes notes, annales etc.</p>
      <p style="text-align: justify;">Pour les plus motiv√©s ou les plus curieux d‚Äôentre vous, vous trouverez √©galement mes notes et documents de cours du master El Karoui. J‚Äôaurais aim√© disposer de tous ces documents d√®s mon arriv√©e au master, j‚Äôesp√®re donc qu‚Äôils seront d‚Äôune grande aide pour les prochains Isfa√Øens qui se lanceront dans l‚Äôaventure quantitative.</p>
      <p style="text-align:center;"><strong>Bonnes r√©visions les loulous</strong></p>

      <div class="box-grid" role="list">
        <div class="box" role="listitem"><a href="html_files/l3_actuariat.html">L3 Actuariat</a></div>
        <div class="box" role="listitem"><a href="html_files/m1_actuariat.html">M1 Actuariat</a></div>
        <div class="box" role="listitem"><a href="html_files/m2_actuariat.html">M2 Actuariat</a></div>
        <div class="box box-gold" role="listitem"><a href="html_files/EK.html">Master El Karoui <br><span style="font-size:0.9em;">(pour les stars ‚≠ê)</span></a></div>
      </div>
    </section>

    <section class="brainteaser-box">
      <div class="brainteaser-header">
        <h3 class="brainteaser-title"><span class="brainteaser-icon">üß†</span>Brainteaser du jour</h3>
        <button id="new-brainteaser-btn" class="brainteaser-button">üîÑ Voir un autre</button>
      </div>

      <div class="brainteaser-flex">
        <div id="brainteaser" class="brainteaser-content">Chargement...</div>
      </div>

      <div id="brainteaser-answer"></div>
    </section>
  </main>

  <div style="height: 2rem;"></div>

  <!-- Footer -->
  <footer class="sticky">
    Th√©o Jalabert | Tous droits r√©serv√©s ¬© 2025
  </footer>
</body>
</html>