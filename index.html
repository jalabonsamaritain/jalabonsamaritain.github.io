<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="/images/logo_isfa.png" type="image/png">
  <title>JalabonSamaritain</title>
  <style>
    /* (styles identiques) */
  </style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

  <script>
    // --- util: hash d√©terministe pour "un brainteaser par jour" ---
    function hashString(s){let h=5381;for(let i=0;i<s.length;i++)h=((h<<5)+h)+s.charCodeAt(i);return h>>>0;}
    function todayKey(){const d=new Date();const yyyy=d.getFullYear();const mm=String(d.getMonth()+1).padStart(2,"0");const dd=String(d.getDate()).padStart(2,"0");return `${yyyy}-${mm}-${dd}`;}

    // TOUT vient de /brainteasers/ √† la racine du domaine
    const BT_BASE = "/brainteasers/";

    let LIST=[];              
    let currentIdx=null;      
    const seenToday=new Set();

    async function loadIndex(){
      const r=await fetch(BT_BASE + "index.json",{cache:"no-store"});
      if(!r.ok) throw new Error("index.json introuvable");
      const data=await r.json();
      if(!Array.isArray(data)||data.length===0) throw new Error("index.json vide");
      LIST=data;
    }

    async function render(entry){
      const el=document.getElementById("brainteaser");
      el.textContent="Chargement...";
      const r=await fetch(BT_BASE + entry.file,{cache:"no-store"});
      if(!r.ok){ el.textContent="Fichier introuvable : " + entry.file; return; }
      el.innerHTML=await r.text();
      if(typeof MathJax!=="undefined") MathJax.typeset();
    }

    function pickDaily(){ return hashString(todayKey()) % LIST.length; }
    function pickRandom(excludeSet){
      if(LIST.length<=excludeSet.size) excludeSet.clear();
      let idx; do { idx=Math.floor(Math.random()*LIST.length); } while (excludeSet.has(idx));
      excludeSet.add(idx);
      return idx;
    }

    async function initBT(){
      try{
        await loadIndex();
        currentIdx=pickDaily();
        seenToday.add(currentIdx);
        await render(LIST[currentIdx]);

        const btn=document.getElementById("new-brainteaser-btn");
        if(btn){
          btn.addEventListener("click", async ()=>{
            currentIdx=pickRandom(seenToday);
            await render(LIST[currentIdx]);
          });
        }
      }catch(e){
        console.error(e);
        const el=document.getElementById("brainteaser");
        if(el) el.textContent="Erreur de chargement du brainteaser.";
      }
    }

    document.addEventListener("DOMContentLoaded", initBT);
  </script>
</head>
<body>
  <header>
    <h1><a href="index.html">JalabonSamaritain</a></h1>
  </header>

  <nav>
    <a href="index.html">Accueil</a>
    <a href="html_files/about.html">√Ä propos</a>
    <a href="html_files/contact.html">Contact</a>
  </nav>

  <div class="container_global">
    <h1>Bienvenue sur JalabonSamaritain</h1>
    <p>Ce site internet a pour but de recenser l'ensemble de connaissances n√©cessaires √† l'actuaire pour sa formation.</p>
    <p>Vous y retrouverez les documents mis √† disposition par les professeurs ainsi que l'ensemble de mes notes, annales etc.</p>
    <p>Pour les plus motiv√©s ou les plus curieux d‚Äôentre vous, vous trouverez √©galement mes notes et documents de cours du master El Karoui. J‚Äôaurais aim√© disposer de tous ces documents d√®s mon arriv√©e au master, j‚Äôesp√®re donc qu‚Äôils seront d‚Äôune grande aide pour les prochains Isfa√Øens qui se lanceront dans l‚Äôaventure quantitative.</p>
    <p><h4>Bonnes r√©visions les loulous</h4></p>

    <div class="box-container">
      <div class="box"><a href="html_files/l3_actuariat.html">L3 Actuariat</a></div>
      <div class="box"><a href="html_files/m1_actuariat.html">M1 Actuariat</a></div>
      <div class="box"><a href="html_files/m2_actuariat.html">M2 Actuariat</a></div>
      <div class="box box-gold"><a href="html_files/EK.html">Master El Karoui <br><span style="font-size:0.8em;">(pour les stars ‚≠ê)</span></a></div>
    </div>
  </div>

  <div class="brainteaser-box">
    <div class="brainteaser-header">
      <h3><span class="brainteaser-icon">üß†</span>Brainteaser du jour</h3>
      <button id="new-brainteaser-btn" class="brainteaser-button">üîÑ Voir un autre</button>
    </div>

    <!-- Conteneur brainteaser + bouton -->
    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
      <div id="brainteaser" style="flex:1;">Chargement...</div>
      <!-- <div style="display:flex; flex-direction:column; gap:10px; margin-left:20px;">
        <button id="show-answer-btn" class="brainteaser-button">üí° Solution</button>
      </div> -->
    </div>

    <!-- Conteneur r√©ponse (option Solutions plus tard) -->
    <div id="brainteaser-answer" style="margin-top:1em; display:none; color:#444; font-style:italic;"></div>
  </div>

  <div class="brainteaser-spacer"></div>

  <footer>
    Th√©o Jalabert | Tous droits r√©serv√©s ¬© 2025
  </footer>
</body>
</html>